{"version":3,"sources":["../../app-es6+/controllers/NegociacaoController.js"],"names":["currentInstance","negociacaoController","Negociacao","ListaNegociacoes","Mensagem","MensagemView","NegociacoesView","ConnectionFactory","FiltrarNegociacoes","Bind","DateHelper","NegociacaoDao","NegociacaoController","_$","document","querySelector","bind","form","_form","_dataFocus","_data","data","_quantidade","quantidade","_valor","valor","_ordem","_listaNegociacoes","_mensagem","_init","getConnection","negociacaoDao","listaNegociacoes","forEach","negociacao","adicionaNegociacoes","err","text","Error","addEventListener","event","preventDefault","_criarNegociacao","adiciona","console","log","_limparForm","resultado","filtrar","length","retorno","textToDate","value","parseInt","parseFloat","opcao","prompt","negociacoes","esvaziaNegociacoes","apagarNegociacoes","column","inverterLista","ordenarLista","a","b","reset","focus","adicionarNegociacao","retirarNegociacoes","importarNegociacoes"],"mappings":"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","sourcesContent":["import Negociacao from '../models/Negociacao.js'\nimport ListaNegociacoes from '../models/ListaNegociacoes.js'\nimport Mensagem from '../models/Mensagem.js'\nimport MensagemView from '../views/MensagemView.js'\nimport NegociacoesView from '../views/NegociacoesView.js'\nimport ConnectionFactory from '../services/ConnectionFactory.js'\nimport FiltrarNegociacoes from '../services/FiltrarNegociacoes.js'\nimport Bind from '../helpers/Bind.js'\nimport DateHelper from '../helpers/DateHelper.js'\nimport NegociacaoDao from '../dao/NegociacaoDao.js'\n\nclass NegociacaoController {\n  constructor() {\n    this._$ = document.querySelector.bind(document);\n\n    const form = (this._form = this._$('.form'));\n    this._dataFocus = this._$('#data');\n    this._data = form.data;\n    this._quantidade = form.quantidade;\n    this._valor = form.valor;\n\n    this._ordem = '';\n\n    this._listaNegociacoes = new Bind(\n      new ListaNegociacoes(),\n      new NegociacoesView(this._$('#negociacoesView')),\n      'adicionaNegociacoes',\n      'esvaziaNegociacoes',\n      'ordenarLista',\n      'inverterLista',\n      'removeNegociacao'\n    );\n\n    this._mensagem = new Bind(\n      new Mensagem(),\n      new MensagemView(this._$('#mensagemView')),\n      'text'\n    );\n\n    this._init()\n}\n\n  async _init(){\n\n    try{\n      const getConnection = await ConnectionFactory.getConnection()\n      const negociacaoDao = await new NegociacaoDao(getConnection).listaNegociacoes()\n      return negociacaoDao.forEach(negociacao => this._listaNegociacoes.adicionaNegociacoes(negociacao))\n    }catch(err){\n      this._mensagem.text = err\n      throw new Error(err)\n    }\n\n  }\n\n  adicionarNegociacao() {\n    this._form.addEventListener('submit', async (event) => {\n      event.preventDefault();\n      try{\n        const negociacao = this._criarNegociacao()\n\n        const getConnection = await ConnectionFactory.getConnection()\n        let negociacaoDao = new NegociacaoDao(getConnection).adiciona(negociacao)\n\n        this._listaNegociacoes.adicionaNegociacoes(negociacao);\n        this._mensagem.text = 'Negociação adicionada com sucesso!';\n        console.log(negociacao)\n        this._limparForm()\n\n        return negociacaoDao\n\n      } catch(err){\n        console.log(err)\n        throw new Error('Não foi possível adicionar a negociação!')\n      }\n    });\n  }\n\n  importarNegociacoes() {\n\n    this._$('#importbtn').addEventListener('click', async () =>{\n      try{\n        const getConnection = await ConnectionFactory.getConnection()\n        let resultado = await new FiltrarNegociacoes().filtrar(this._listaNegociacoes)\n        \n        if(resultado.length > 0){\n          let retorno = resultado.forEach(negociacao => {\n            console.log(negociacao)\n            new NegociacaoDao(getConnection).adiciona(negociacao)\n            this._listaNegociacoes.adicionaNegociacoes(negociacao)\n            this._mensagem.text = 'Negociações importadas com sucesso!'\n          })\n    \n          return retorno\n        } else{\n          console.log('Negociacoes já importadas')\n          this._mensagem.text = 'Negociações já importadas.'\n        }\n\n      }catch(err){\n        this._mensagem.text = err\n        console.log(err)\n      }\n    })\n  }\n\n  _criarNegociacao() {\n    return new Negociacao(\n      DateHelper.textToDate(this._data.value),\n      parseInt(this._quantidade.value),\n      parseFloat(this._valor.value)\n    );\n  }\n\n  retirarNegociacoes() {\n    this._$('#apagar').addEventListener('click', async () => {\n      \n      const opcao = prompt(\"Excluir a lista de negociações? 1- sim, 2- não\")\n\n      if (this._listaNegociacoes.negociacoes.length === 0 || opcao == '2' || opcao == null || opcao == '') {\n        return;\n      }\n\n      if(opcao == '1'){\n        try{\n          this._listaNegociacoes.esvaziaNegociacoes();\n\n          const getConnection = await ConnectionFactory.getConnection()\n          const negociacaoDao = await new NegociacaoDao(getConnection).apagarNegociacoes()\n          this._mensagem.text = 'Lista de negociações apagada!';\n          return negociacaoDao\n\n        }catch(err){\n          console.log(err)\n          this._mensagem.text = err\n        }\n      }\n    });\n  }\n\n  ordenarNegociacoes(column) {\n    if (this._ordem === column) {\n      this._listaNegociacoes.inverterLista();\n    } else {\n      this._listaNegociacoes.ordenarLista((a, b) => a[column] - b[column]);\n    }\n    this._ordem = column;\n  }\n\n  /*removerNegociacao(td) {\n    if (td >= 0) {\n      this._listaNegociacoes.removeNegociacao(td)\n\n      ConnectionFactory.getConnection().then(connection => {\n        let indexInt = parseInt(td)\n        new NegociacaoDao(connection).apagarNegociacao(\"1100\")\n      })\n        .catch(err => console.log(err)) \n\n    } \n    this._mensagem.text = 'Negociação apagada com sucesso.'\n  } */\n\n  _limparForm() {\n    this._form.reset();\n    this._dataFocus.focus();\n  }\n}\nconst negociacaoController = new NegociacaoController();\nnegociacaoController.adicionarNegociacao();\nnegociacaoController.retirarNegociacoes();\nnegociacaoController.importarNegociacoes();\n\nexport function currentInstance(){\n  return negociacaoController\n}"],"file":"NegociacaoController.js"}